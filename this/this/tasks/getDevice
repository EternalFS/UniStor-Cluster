---
- name: List of all devices
  block:
  - name: get list of keys
    set_fact:
      diskkeys: "{{ ansible_facts.device_links.ids.keys()|list }}"


  - name: create List of devices
    set_fact:
      all: "{{ all + [ item ] }}"
    loop: "{{ diskkeys }}"

- name: Only raw disks
  block:

  - name: get full device info
    debug:
      var: ansible_facts.devices[item]
    loop: "{{ diskkeys }}"

  - name: get only internal drives
    debug:
      var: ansible_facts.devices[item]
    loop: "{{ diskkeys }}"
    # when: "ansible_facts.devices[item].vendor" == 'ATA'


  - name: try
    debug:
      var: ansible_facts.devices[item].vendor
    when: ansible_facts.devices[item].vendor == "ATA"
    loop: "{{ diskkeys }}"
